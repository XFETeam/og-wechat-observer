{"version":3,"file":"og-wechat-observer.js","sources":["../src/index.js"],"sourcesContent":["const DISPATCH_SHARE_EVENT_NAME = 'meta-info:onShareDataChange';\n\nconst getTitleNode = (() => {\n  const node = document.querySelector('meta[property=\"og:wx-share-title\"]') || document.querySelector('title');\n  node.$$update = (nextValue) => {\n    if (typeof nextValue !== 'string') {\n      throw new Error(`更新值必须为 string 类型, nextValue = ${nextValue}`);\n    }\n    if (node.innerText !== undefined) {\n      node.innerText = nextValue;\n    } else if (node.content !== undefined) {\n      node.content = nextValue;\n    }\n  };\n  return shouldGetValue => (shouldGetValue ? (node.innerText || node.content) : node);\n})();\n\nconst getDescriptionMetaNode = (() => {\n  const node = document.querySelector('meta[property=\"og:wx-share-description\"]')\n    || document.querySelector('meta[name=description]');\n  node.$$update = (nextValue) => {\n    if (typeof nextValue !== 'string') {\n      throw new Error(`更新值必须为 string 类型, nextValue = ${nextValue}`);\n    }\n    node.content = nextValue;\n  };\n  return shouldGetValue => (shouldGetValue ? node.content : node);\n})();\n\nconst getShareUrlMetaNode = (() => {\n  const node = document.querySelector('meta[property=\"og:wx-share-url\"]');\n  node.$$update = (nextValue) => {\n    if (typeof nextValue !== 'string') {\n      throw new Error(`更新值必须为 string 类型, nextValue = ${nextValue}`);\n    }\n    node.content = nextValue;\n  };\n  return shouldGetValue => (shouldGetValue ? node.content : node);\n})();\n\nconst config = { attributes: true, childList: true, subtree: true };\n\nlet observer;\n\nconst callback = (function callback() {\n  let title = getTitleNode(true);\n  let description = getDescriptionMetaNode(true);\n  const shareUrl = getShareUrlMetaNode(true);\n  return () => {\n    const currentTitle = getTitleNode(true);\n    const currentDescription = getDescriptionMetaNode(true);\n    const currentShareUrl = getShareUrlMetaNode(true);\n    if (currentTitle !== title || currentDescription !== description || currentShareUrl !== shareUrl) {\n      title = currentTitle;\n      description = currentDescription;\n      window.dispatchEvent(new CustomEvent(DISPATCH_SHARE_EVENT_NAME, {\n        detail: {\n          title: currentTitle,\n          description: currentDescription,\n        },\n      }));\n    }\n  };\n}());\n\n[\n  getTitleNode(),\n  getDescriptionMetaNode(),\n  getShareUrlMetaNode(),\n].forEach((node) => {\n  observer = new MutationObserver(callback).observe(node, config);\n});\n\nexport default {\n  update({ title, description }) {\n    if (title) {\n      getTitleNode().$$update(title);\n    }\n    if (description) {\n      getDescriptionMetaNode().$$update(description);\n    }\n  },\n  destroyObserver() {\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n    }\n  },\n};\n"],"names":["const","node","observer","title","description","shareUrl","getTitleNode","document","querySelector","$$update","nextValue","Error","undefined","innerText","content","shouldGetValue","getDescriptionMetaNode","getShareUrlMetaNode","config","attributes","childList","subtree","callback","currentTitle","currentDescription","currentShareUrl","window","dispatchEvent","CustomEvent","detail","forEach","MutationObserver","observe","update","ref","destroyObserver","disconnect"],"mappings":"AAAAA,IAGQC,EAuCJC,EAGEC,EACAC,EACEC,EA7CFC,IACEL,EAAOM,SAASC,cAAc,uCAAyCD,SAASC,cAAc,UAC/FC,kBAAYC,MACU,iBAAdA,QACH,IAAIC,uCAAuCD,QAE5BE,IAAnBX,EAAKY,UACPZ,EAAKY,UAAYH,OACSE,IAAjBX,EAAKa,UACdb,EAAKa,QAAUJ,aAGZK,UAAmBA,EAAkBd,EAAKY,WAAaZ,EAAKa,QAAWb,IAG1Ee,EAAyB,eACvBf,EAAOM,SAASC,cAAc,6CAC/BD,SAASC,cAAc,iCAC5BP,EAAKQ,kBAAYC,MACU,iBAAdA,QACH,IAAIC,uCAAuCD,GAEnDT,EAAKa,QAAUJ,YAEVK,UAAmBA,EAAiBd,EAAKa,QAAUb,GAT7B,GAYzBgB,EAAsB,eACpBhB,EAAOM,SAASC,cAAc,2CACpCP,EAAKQ,kBAAYC,MACU,iBAAdA,QACH,IAAIC,uCAAuCD,GAEnDT,EAAKa,QAAUJ,YAEVK,UAAmBA,EAAiBd,EAAKa,QAAUb,GARhC,GAWtBiB,EAAS,CAAEC,YAAY,EAAMC,WAAW,EAAMC,SAAS,GAIvDC,GACAnB,EAAQG,GAAa,GACrBF,EAAcY,GAAuB,GACnCX,EAAWY,GAAoB,kBAE7BM,EAAejB,GAAa,GAC5BkB,EAAqBR,GAAuB,GAC5CS,EAAkBR,GAAoB,GACxCM,IAAiBpB,GAASqB,IAAuBpB,GAAeqB,IAAoBpB,IACtFF,EAAQoB,EACRnB,EAAcoB,EACdE,OAAOC,cAAc,IAAIC,YAvDG,8BAuDoC,CAC9DC,OAAQ,CACN1B,MAAOoB,EACPnB,YAAaoB,SAOvB,CACElB,IACAU,IACAC,KACAa,iBAAS7B,GACTC,EAAW,IAAI6B,iBAAiBT,GAAUU,QAAQ/B,EAAMiB,oBAG3C,CACbe,gBAAOC,iCACD/B,GACFG,IAAeG,SAASN,GAEtBC,GACFY,IAAyBP,SAASL,IAGtC+B,2BACMjC,IACFA,EAASkC,aACTlC,EAAW"}